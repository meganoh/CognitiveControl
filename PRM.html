<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>
        <script src="jspsych/dist/jspsych.js"></script>
        <script src="jspsych/dist/plugin-html-keyboard-response.js"></script>
        <script src="jspsych/dist/plugin-image-keyboard-response.js"></script>
        <script src="jspsych/dist/plugin-preload.js"></script>
        <script src="jspsych/dist/plugin-external-html.js"></script>

        <link href="jspsych/dist/jspsych.css" rel="stylesheet" type="text/css" />
    </head>
    <body></body>
    

    
    <script>
  
        /* VARIABLES */
  
        const num_steps = 20;
        const stim_dur  = 2000; /* milliseconds */
        const fix_dur = 200;

        const num_ima_trials = 9; /*10th is the critical one */
        const num_ima_reps = 1; /* how often to repeat the 2 orientations */


        /* GLOBAL VARIABLES */
        window.vis_level = 38;
        window.stim_id  = 0; /* left */
        window.trl_num = 0;
        window.block_num = 0;

        /*ESSENTIALS*/

        /* fixation */
        var fixation = {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: '<div style="font-size:60px;">+</div>',
          choices: "NO_KEYS",
          trial_duration: fix_dur,
          data: {task: 'fixation'}
        };

         /* update trial number */
        var update_trial_number = {
            type: "call-function",
            func: function() { 
                window.trl_num++;
            }
        };


        /* PRELOAD IMAGES */ 
        var images = []

  
        /* TIMELINE */
  
        var timeline = [];

        /* WELCOME MESSAGE*/
        
        var welcome = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: "Welcome to the experiment. Press any key to begin."
        };

        timeline.push(welcome)

        var preload = {
            type: jsPsychPreload,
            stimulus: ["img/stim_1_vis_50.png", "img/stim_2_vis_50.png"]
        };    
        timeline.push(preload);

        /* INSTRUCTIONS */
        
        var instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <p> During the next part of this experiment you will imagine <strong> gratings </strong> while looking at <strong>noise</strong> (see below) </p>
            <p> <strong>Gratings</strong> are images of alternating black and white lines (left) </p>
            <p> <strong>Noise</strong> is a collection of random black and white pixels (middle) </p>
            <p> Please imagine the grating as vividly as possible, as if it was actually presented on the screen (right). </p>
            <p> After every trial you will be asked to report how vivid your imagery was </p>
            <img src='img/example_stim-01.png' width=600 ></img>
            </div>
            <p>Press [space] to continue </p>
        `,
            choices: [' '],
        };
        timeline.push(instructions);

        
        /* IMAGERY INSTRUCTIONS */

        var instr_imagery = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: function() {
                if (window.stim_id == 0) {
                    var stim_instr = "a left tilted grating";
                    var stim_pic = 'img/stim_1_vis_50.png';
                } else if (window.stim_id == 1) {
                    var stim_instr = "a right tilted grating";
                    var stim_pic = 'img/stim_2_vis_50.png';
                }
                return `
                <p> During the next few trials, please imagine `  + stim_instr + `</p> 
                <p> Imagine the grating as vividly as possible, as if it was actually presented on the screen (see below) </p>
                <p> Please keep your eyes open and look at the noise while imagining </p>
                <p> After each trial, you will be asked to rate the vividness of your imagery </p> 
                <p> on a scale from 1 (not vivid at all) to 5 (perfectly clear and as vivid as real seeing) </p>
                <img src=` + stim_pic + ` width=200 ></img>
                </div>
                <p>Press [space] to continue </p>
                ` 
            },
            choices: [' '],
            post_trial_gap: 500, 
        }
        timeline.push(instr_imagery);

        
        /* INFORMATION SHEET */

        var information_sheet = {
            type: jsPsychExternalHtml,
            url: "InformationSheet.html",
            cont_btn: "Start"
        };

        timeline.push(information_sheet);


        /* CONSENT */

        var check_consent_function = function(elem) {
            if (document.getElementById('consent_checkbox').checked) {
                return true
            }
            else {
                alert("If you wish to participate, must check the box next to the statement 'I agree to participate in this study'");
                return false;
            }
            return false
        };

        var consent_form = {
            type: jsPsychExternalHtml,
            url: "ConsentForm.html",
            cont_btn: "Start",
            check_fn: check_consent_function
        };

        timeline.push(consent_form)



        /* INIT JS PSYCH */
        
        var jsPsych = initJsPsych({
            on_finish: function() {
                jsPsych.data.displayData();
            }
        });

        jsPsych.run(timeline);
  
    </script>
</html>